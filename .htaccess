# .htaccess for Next.js standalone on cPanel (with Setup Node.js App)
# Mostly for security + HTTPS — proxy is handled by cPanel/Passenger

RewriteEngine On

# 1. Force HTTPS (almost always needed on shared hosts)
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 2. Optional: Remove www (good for SEO & consistency)
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# 3. Protect sensitive files (very important!)
<FilesMatch "\.(env|yaml|yml|json|lock|log|md|git.*|next\.config\.js|server\.js|package\.json)$">
    Order Allow,Deny
    Deny from all
</FilesMatch>

# 4. Disable directory listing
Options -Indexes

# 5. Optional: trailing slash consistency (if trailingSlash: false in next.config.js)
# Uncomment if you have routing issues on subpages/refresh
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule ^(.*[^/])$ /$1/ [L,R=301]

# Note: Do NOT add proxy rules here — cPanel handles them.
# If you see 404 on refresh/subpages → check Node.js App is running + restarted.